# CA HW02

PB18000221 袁一玮

## EX1

原题的 MIPS 改成 RISCV 会有 32bit 无法放下立即数 7000 的问题，因为立即数最大只有 `2<<12 = 4000`，需要使用 `lui` 指令加载高位

```asm
    lui x1, 1
    lui x3, 3
    lui x5, 5
    lui x7, 7
    xor x2, x0, x0
    sw x2, x7, 0
    lw x4, x5, 0
    addi x6, x0, 100
Loop:
    add x8, x3, x2
    add x9, x1, x2
    lw x10, x8, 0
    add x11, x10, x4
    addi x2, x2, 1
    sw x11, x9, 0
    sw x2, x7, 0
    bge x6, x2, Loop
```

指令数为 8\*100+8\*1 = 808
以每条代码 4 B = 32 bit 计算，一共 16\*4 = 64 B

## EX2

1：一个地址一共 $32 = 2^5$ 个寄存器，要用 5 位地址

两地址用 10 位地址，剩下 2 位可编码 4 种指令，3 个两地址指令可以留下 1 位编码余下的单地址和零地址指令
单地址用 5 位地址，1 位表明非两地址，剩下 6 位，30 个单地址指令
对于零地址指令，1 位表明非两地址，可以扩展 6 位实现不同的零地址指令

是可以实现的

2：容量是不够的

3 条两地址指令用掉了 $3*2^{10}$ 条，31 条单地址指令用掉了 $31*2^5$ 条，最后只剩下 $2^5$ 条给零地址指令，而总共有 35 条零地址指令

3：已经有了 3 个两个地址指令和 24 个零地址指令，用掉了 $3*2^{10} + 24*1$，最后可以有 $\lfloor (2^{10} - 24)/2^{5} \rfloor = 31$ 条给单地址指令

## EX3

1：big-endian 内存排布为 0100 0011, 0100 1111, 0100 1101, 0101 0000, 0101 0101, 0101 0100, 0100 0101, 0101 0010，其 ASCII 为 COMPUTER
2：little-endian 内存排布为 0100 0101, 0101 0010, 0101 0101, 0101 0100, 0100 1101, 0101 0000, 0100 0011, 0100 1111，其 ASCII 为 ERUTMPCO
3：双字有 4F4D, 5055, 5445
4：四字有 5255544D, 55544D50, 544D5043

## EX4

1：流水线取最长的周期，2.1 ns
2：$\text{CPI} = \frac{5}{4} = 1.25$
3：加速比 $\text{S} = \frac{\text{T}_{0}}{\text{T}_5} = \frac{7ns \times 1 \times Instr}{2.1ns \times 1.25 \times Instr} \approx 2.667$

## EX5

第一台机器：$\text{CPI} = 1 + \frac{1}{5} = 1.2$
第二台机器：$\text{CPI} = 1 + \frac{3}{8} = 1.375$

只有数据相关，加速比为 $\text{S} = \frac{\text{T}_{5}}{\text{T}_{12}} = \frac{Instr \times 1.2 \times 1ns}{Instr \times 1.375 \times 0.6ns} \approx 1.455$

若有分支预测错误的损耗
第一台机器：$\text{CPI} = 1 + \frac{1}{5} + 2 \times 0.2 \times 0.05 = 1.22$
第二台机器：$\text{CPI} = 1 + \frac{3}{8} + 5 \times 0.2 \times 0.05 = 1.425$

## EX6

先流水线计算四次 $A_i+B_i$ 加法（得 $S_i$），再分别计算 $T = S_1 \times S_2$、$T = T \times S_3$、$T = T \times S_4$ 乘法

![6](./6.png)

吞吐率为 $\frac{7}{16\Delta t}$
加速比 $\text{S}=\frac{4*5\Delta t+3*3\Delta t}{16\Delta t}=\frac{29}{16}$
效率 $\text{E}=\text{S}/5=\frac{29}{80}$
